<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>{{ kp.title or '–ö–æ–º–µ—Ä—Ü—ñ–π–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è' }}</title>
    <!-- Google Fonts - —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–π –Ω–∞–±—ñ—Ä -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Inter:wght@400;500;600&family=Roboto:wght@400;500;700&family=Open+Sans:wght@400;600;700&family=Playfair+Display:wght@400;600;700&family=Oswald:wght@400;500;600&family=Lora:wght@400;600;700&family=Raleway:wght@400;500;700&family=PT+Sans:wght@400;700&family=Nunito:wght@400;600;700&family=Source+Sans+3:wght@400;600;700&family=Merriweather:wght@400;700&family=Poppins:wght@400;500;600;700&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Gilroy —à—Ä–∏—Ñ—Ç —á–µ—Ä–µ–∑ CDN -->
    <link rel="preconnect" href="https://fonts.cdnfonts.com" crossorigin>
    <link href="https://fonts.cdnfonts.com/css/gilroy" rel="stylesheet">
    <style>
        /* === –ö–û–õ–¨–û–†–û–í–ê –°–•–ï–ú–ê (–¥–∏–Ω–∞–º—ñ—á–Ω–∞ –∑ —à–∞–±–ª–æ–Ω—É) === */
        :root {
            --orange-format: {{ format_bg_color or '#FF8C00' }};      /* –§–æ–Ω —Ñ–æ—Ä–º–∞—Ç—É (–§–£–†–®–ï–¢ 13:30-14:30) */
            --orange-categories: {{ category_bg_color or '#FFB84D' }};   /* –§–æ–Ω –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —Å—Ç—Ä–∞–≤ */
            --orange-header: {{ table_header_bg_color or '#FFA500' }};   /* –§–æ–Ω —à–∞–ø–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ */
            --orange-text: {{ primary_color or '#FF8C00' }};         /* –î–ª—è –∞–∫—Ü–µ–Ω—Ç—ñ–≤ (—Ü—ñ–Ω–∏) */
            --summary-bg: {{ summary_bg_color or '#F3F4F6' }};       /* –§–æ–Ω "–î–û –°–ü–õ–ê–¢–ò –ó–ê..." */
            --total-bg: {{ total_bg_color or '#FF8C00' }};           /* –§–æ–Ω "–í–°–¨–û–ì–û –î–û –°–ü–õ–ê–¢–ò" */
            --text-dark: {{ text_color or '#333333' }};
            --text-gray: #666666;
            --border-light: #E5E5E5;
            --bg-gray: #666666;
            
            /* –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —Ç–∞ —Å—Ç—Ä–∞–≤ */
            --category-text-align: {{ category_text_align or 'center' }};
            --category-text-color: {{ category_text_color or 'white' }};
            --dish-text-align: {{ dish_text_align or 'left' }};
            --dish-text-color: {{ dish_text_color or 'var(--text-dark)' }};
            
            /* –®—Ä–∏—Ñ—Ç–∏ */
            --font-title: {{ title_font or 'Montserrat, Arial, sans-serif' }};
            --font-header: {{ header_font or 'Montserrat, Arial, sans-serif' }};
            --font-body: {{ body_font or 'Inter, Arial, sans-serif' }};
            --font-table: {{ table_font or 'Inter, Arial, sans-serif' }};
        }
        
        @page {
            size: {% if template_config and template_config.page_orientation == 'landscape' %}A4 landscape{% else %}A4{% endif %};
            margin: 10mm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* === –®–†–ò–§–¢–ò === */
        body {
            font-family: var(--font-body);
            font-weight: 400;
            color: var(--text-dark);
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 10pt;
        }
        
        /* –ì–æ–ª–æ–≤–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        h1, .main-title h1 {
            font-family: var(--font-title);
            font-weight: 700;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü—ñ–π */
        h2, .format-title, .category-title, .section-header {
            font-family: var(--font-header);
            font-weight: 700;
        }
        
        /* –ñ–∏—Ä–Ω–∏–π –∞–∫—Ü–µ–Ω—Ç */
        .header-info strong, .price, .client-info-label {
            font-family: var(--font-body);
            font-weight: 600;
        }
        
        /* –¢–∞–±–ª–∏—Ü—è */
        .table-header, .menu-table, .menu-table td {
            font-family: var(--font-table);
        }
        
        .container {
            max-width: 100%;
        }
        
        /* === –®–ê–ü–ö–ê - –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º === */
        .header-image {
            width: 100%;
            height: auto;
            margin-bottom: 0;
        }
        
        /* === –ì–û–õ–û–í–ù–ò–ô –ó–ê–ì–û–õ–û–í–û–ö –ö–ü === */
        .main-title {
            text-align: center;
            padding: 5mm 0;
        }
        
        .main-title h1 {
            font-family: var(--font-title);
            font-size: 18pt;
            font-weight: 700;
            color: var(--orange-text);
            text-transform: uppercase;
            margin-bottom: 3mm;
            letter-spacing: 0.5px;
        }
        
        .manager-info {
            display: table;
            width: 100%;
            text-align: center;
        }
        
        .manager-info-row {
            display: table-row;
        }
        
        .manager-info-cell {
            display: table-cell;
            color: var(--orange-text);
            font-size: 10pt;
            font-weight: 500;
            padding: 0 5mm;
        }
        
        /* === –ë–õ–û–ö –Ü–ù–§–û–†–ú–ê–¶–Ü–á –ü–†–û –ö–õ–Ü–Ñ–ù–¢–ê === */
        .client-info {
            display: table;
            width: 100%;
            margin: 5mm 0;
            padding: 3mm 0;
        }
        
        .client-info-row {
            display: table-row;
        }
        
        .client-info-col {
            display: table-cell;
            width: 50%;
            vertical-align: top;
            padding: 0 3mm;
        }
        
        .client-info-line {
            padding: 1.5mm 0;
            font-size: 10pt;
        }
        
        .client-info-label {
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .client-info-value {
            font-weight: 600;
        }
        
        /* === –ë–õ–û–ö –§–û–†–ú–ê–¢–£ –ó–ê–•–û–î–£ (–§–£–†–®–ï–¢ 13:30-14:30) === */
        .section-header {
            background: var(--orange-format);
            color: white;
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 16pt;
            font-weight: 700;
            text-align: center;
            padding: 4mm;
            margin-top: 5mm;
            margin-bottom: 4mm;  /* –í—ñ–¥—Å—Ç—É–ø –¥–æ —à–∞–ø–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ */
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* === –®–ê–ü–ö–ê –¢–ê–ë–õ–ò–¶–Ü (–ù–ê–ó–í–ê, –§–û–¢–û, –í–ê–ì–ê...) === */
        .table-header {
            display: table;
            width: 100%;
            background: var(--orange-header);
            color: white;
            font-family: 'Inter', Arial, sans-serif;
            font-size: 9pt;
            font-weight: 600;
            margin-top: 0;
        }
        
        .table-header-row {
            display: table-row;
        }
        
        .table-header-cell {
            display: table-cell;
            padding: 2.5mm 2mm;
            text-align: center;
            vertical-align: middle;
            border-right: 1px solid rgba(255,255,255,0.3);
            text-transform: lowercase;
        }
        
        .table-header-cell:first-child {
            text-transform: uppercase;
        }
        
        .table-header-cell:last-child {
            border-right: none;
        }
        
        .table-header-cell.name-col {
            text-align: left;
            width: 35%;
            padding-left: 3mm;
        }
        
        .table-header-cell.photo-col {
            width: 15%;
        }
        
        .table-header-cell.value-col {
            width: 12.5%;
        }
        
        /* === –†–û–ó–î–Ü–õ–Æ–í–ê–ß –ö–ê–¢–ï–ì–û–†–Ü–ô === */
        .category-separator {
            width: 100%;
            margin: 3mm 0;
            display: block;
            max-height: 15mm; /* –û–±–º–µ–∂—É—î–º–æ –≤–∏—Å–æ—Ç—É —Ä–æ–∑–¥—ñ–ª—é–≤–∞—á–∞ */
            overflow: hidden;
        }
        
        .category-separator img {
            width: 100%;
            height: auto;
            max-height: 15mm; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞ 15mm (‚âà57px) */
            display: block;
            object-fit: contain;
        }
        
        /* === –ö–ê–¢–ï–ì–û–†–Ü–Ø –°–¢–†–ê–í - –ù–ê –í–°–Æ –®–ò–†–ò–ù–£ === */
        .category-row {
            width: 100%;
            margin: 5mm 0 3mm 0;
        }
        
        .category-pill {
            background: var(--orange-categories);
            color: var(--category-text-color);
            font-family: 'Montserrat', Arial, sans-serif;
            font-weight: 700;
            text-align: var(--category-text-align);
            padding: 3mm 0;
            width: 100%;
            border-radius: 15px;
            text-transform: uppercase;
            font-size: 11pt;
            letter-spacing: 0.5px;
        }
        
        /* === –†–Ø–î–û–ö –°–¢–†–ê–í–ò === */
        .item-row {
            display: table;
            width: 100%;
            border-bottom: 1px solid var(--border-light);
        }
        
        .item-row-inner {
            display: table-row;
        }
        
        .item-cell {
            display: table-cell;
            padding: 3mm 2mm;
            vertical-align: middle;
            font-size: 10pt;
        }
        
        .item-cell.name-col {
            width: 35%;
            text-align: var(--dish-text-align);
            padding-left: 3mm;
            color: var(--dish-text-color);
        }
        
        .item-cell.photo-col {
            width: 15%;
            text-align: center;
        }
        
        .item-cell.value-col {
            width: 12.5%;
            text-align: center;
        }
        
        /* === –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ò –°–¢–†–ê–í === */
        .item-row-alternative {
            background-color: #FFF5E6;
            border-left: 3px solid #FF8C00;
        }
        
        .alternative-badge {
            display: inline-block;
            background-color: #FF8C00;
            color: white;
            font-size: 7pt;
            font-weight: 700;
            padding: 1mm 2mm;
            border-radius: 3px;
            margin-right: 2mm;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .alternative-hint {
            display: block;
            font-size: 8pt;
            color: #FF8C00;
            font-style: italic;
            margin-top: 1mm;
            margin-left: 0;
        }
        
        /* === –Ü–ö–û–ù–ö–ê –ì–û–¢–£–í–ê–ù–ù–Ø –ù–ê –õ–û–ö–ê–¶–Ü–á === */
        .location-icon {
            display: inline-block;
            font-size: 10pt;
            margin-left: 2mm;
            vertical-align: middle;
        }
        
        .item-photo {
            width: 18mm;
            height: 18mm;
            object-fit: cover;
            border-radius: 2mm;
        }
        
        /* === –ë–õ–û–ö –ü–Ü–î–°–£–ú–ö–Ü–í (–î–û –°–ü–õ–ê–¢–ò –ó–ê...) === */
        .summary-gray {
            background: var(--summary-bg);
            color: #333333;
            padding: 3mm 5mm;
            margin-top: 2mm;
        }
        
        .summary-gray-line {
            padding: 1mm 0;
            font-size: 10pt;
        }
        
        .summary-gray-bold {
            font-weight: 600;
            font-size: 11pt;
        }
        
        /* === –§–Ü–ù–ê–õ–¨–ù–ò–ô –ü–Ü–î–°–£–ú–û–ö === */
        .final-summary {
            background: var(--total-bg);
            color: white;
            padding: 4mm 5mm;
            margin-top: 5mm;
            text-align: center;
        }
        
        .final-summary-main {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 14pt;
            font-weight: 700;
            padding: 2mm 0;
        }
        
        .final-summary-fop {
            font-size: 11pt;
            font-weight: 600;
            padding: 1mm 0;
        }
        
        /* === –¢–ê–ë–õ–ò–¶–Ø –°–ï–†–í–Ü–°–£ === */
        .service-row {
            display: table;
            width: 100%;
            border-bottom: 1px solid var(--border-light);
        }
        
        .service-cell {
            display: table-cell;
            padding: 3mm 2mm;
            vertical-align: middle;
            font-size: 10pt;
        }
        
        .service-cell.name-col {
            width: 75%;
            text-align: left;
        }
        
        .service-cell.value-col {
            width: 25%;
            text-align: right;
        }
        
        /* === –£–ú–û–í–ò –ë–†–û–ù–Æ–í–ê–ù–ù–Ø === */
        .booking-terms {
            margin-top: 8mm;
            padding: 0 3mm;
        }
        
        .booking-terms-title {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 13pt;
            font-weight: 800;
            text-align: center;
            margin-bottom: 4mm;
            text-transform: uppercase;
            color: var(--orange-text);
            letter-spacing: 0.5px;
        }
        
        .booking-terms-list {
            font-size: 9pt;
            line-height: 1.6;
        }
        
        .booking-terms-item {
            padding: 1mm 0;
            padding-left: 5mm;
            text-indent: -3mm;
        }
        
        .booking-terms-item:before {
            content: "‚Ä¢ ";
            color: var(--orange-text);
        }
        
        .booking-terms-bold {
            font-weight: 600;
        }
        
        /* === –ì–ê–õ–ï–†–ï–Ø === */
        .gallery {
            margin-top: 8mm;
            page-break-inside: avoid;
        }
        
        .gallery-row {
            display: table;
            width: 100%;
            table-layout: fixed;
            border-collapse: separate;
            border-spacing: 2mm;
            margin-bottom: 2mm;
        }
        
        .gallery-item {
            display: table-cell;
            width: 33.333%;
            vertical-align: top;
        }
        
        .gallery-photo {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 2mm;
        }
        
        /* === –§–£–¢–ï–† === */
        .footer {
            margin-top: 8mm;
            padding-top: 3mm;
            text-align: center;
            font-size: 9pt;
            color: var(--text-gray);
        }
        
        /* === –¶–Ü–ù–ò - –ê–ö–¶–ï–ù–¢–ù–ò–ô –ö–û–õ–Ü–† === */
        .price-accent {
            color: var(--orange-text);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ (–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º) -->
        {% if header_image_src %}
        <img src="{{ header_image_src }}" alt="Header" class="header-image">
        {% endif %}
        
        <!-- –ì–æ–ª–æ–≤–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="main-title">
            <h1>{{ title_text or '–ö–û–ú–ï–†–¶–Ü–ô–ù–ê –ü–†–û–ü–û–ó–ò–¶–Ü–Ø' }} {{ template_company_name or company_name or '–î–ó–ò“ê–ê –ö–ï–ô–¢–ï–†–Ü–ù“ê' }}</h1>
            <div class="manager-info">
                <div class="manager-info-row">
                    <span class="manager-info-cell">–ú–µ–Ω–µ–¥–∂–µ—Ä: {{ manager_name or '‚Äî' }}</span>
                    <span class="manager-info-cell">–ù–æ–º–µ—Ä: {{ manager_phone or '‚Äî' }}</span>
                    <span class="manager-info-cell">–ü–æ—à—Ç–∞: {{ manager_email or '‚Äî' }}</span>
                </div>
            </div>
        </div>
        
        <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–ª—ñ—î–Ω—Ç–∞ -->
        <div class="client-info">
            <div class="client-info-row">
                <div class="client-info-col">
                    <div class="client-info-line"><span class="client-info-label">–ó–∞–º–æ–≤–Ω–∏–∫:</span> {{ kp.client_name or '‚Äî' }}</div>
                    <div class="client-info-line"><span class="client-info-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:</span> {{ kp.client_phone or '‚Äî' }}</div>
                    <div class="client-info-line"><span class="client-info-label">–ü–æ—à—Ç–∞:</span> {{ kp.client_email or '‚Äî' }}</div>
                    <div class="client-info-line"><span class="client-info-label">–§–æ—Ä–º–∞—Ç:</span> {{ event_format_display or kp.event_format or '‚Äî' }}</div>
                    <div class="client-info-line"><span class="client-info-label">–ú—ñ—Å—Ü–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è:</span> {{ kp.event_location or '‚Äî' }}</div>
                </div>
                <div class="client-info-col">
                    <div class="client-info-line">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∑–∞—Ö–æ–¥—É: <span class="client-info-value">{{ kp.event_time or '‚Äî' }}</span></div>
                    <div class="client-info-line">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ—Å—Ç–µ–π: <span class="client-info-value">{{ people_count or kp.people_count or '‚Äî' }}</span></div>
                    <div class="client-info-line">–í–∏—Ö—ñ–¥ –≥/–ª—é–¥–∏–Ω–∞: <span class="client-info-value">{{ weight_per_person or '‚Äî' }} –≥—Ä–∞–º</span></div>
                    <div class="client-info-line">–í–∏—Ö—ñ–¥ –≥—Ä–Ω/–ª—é–¥–∏–Ω–∞: <span class="client-info-value">{% if price_per_person_total_formatted %}{{ price_per_person_total_formatted }}{% else %}‚Äî{% endif %}</span></div>
                    {% if ml_per_person_formatted %}
                    <div class="client-info-line">–í–∏—Ö—ñ–¥ –º–ª/–ª—é–¥–∏–Ω–∞: <span class="client-info-value">{{ ml_per_person_formatted }}</span></div>
                    {% endif %}
                    <div class="client-info-line">–í—Å—å–æ–≥–æ –¥–æ —Å–ø–ª–∞—Ç–∏: <span class="client-info-value price-accent">{{ grand_total_formatted or '‚Äî' }}</span></div>
                </div>
            </div>
        </div>
        
        <!-- –ú–ï–ù–Æ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞—Ö -->
        {% if formats %}
        {% for fmt in formats %}
        
        <!-- –•–µ–¥–µ—Ä —Ñ–æ—Ä–º–∞—Ç—É (–§–£–†–®–ï–¢ 13:30-14:30) -->
        <div class="section-header">
            {% if fmt.event_time %}{{ fmt.name if fmt.name else "–ú–ï–ù–Æ" }}({{ fmt.event_time }}){% else %}{{ fmt.name if fmt.name else "–ú–ï–ù–Æ" }}{% endif %}{% if formats|length > 1 and not fmt.event_time %} {{ loop.index }}{% endif %}
        </div>
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ –º–µ–Ω—é -->
        <div class="table-header">
            <div class="table-header-row">
                <div class="table-header-cell name-col">–ù–ê–ó–í–ê</div>
                <div class="table-header-cell photo-col">–§–û–¢–û</div>
                <div class="table-header-cell value-col">–≤–∞–≥–∞ –ø–æ—Ä—Ü—ñ—ó, –≥</div>
                <div class="table-header-cell value-col">–∫-—Å—Ç—å –ø–æ—Ä—Ü—ñ–π</div>
                <div class="table-header-cell value-col">—Ü—ñ–Ω–∞, –≥—Ä–Ω</div>
                <div class="table-header-cell value-col">—Å—É–º–∞, –≥—Ä–Ω</div>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–≤–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö -->
        {% for section in menu_sections %}
        {% set section_items = fmt['items'] | selectattr('category_name', 'equalto', section) | list %}
        
        {% if section_items %}
        <!-- –†–æ–∑–¥—ñ–ª—é–≤–∞—á –∫–∞—Ç–µ–≥–æ—Ä—ñ–π (–ø–µ—Ä–µ–¥ –∫–æ–∂–Ω–æ—é –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é) -->
        {% if category_separator_image_url %}
        <div class="category-separator">
            <img src="{{ category_separator_image_url }}" alt="–†–æ–∑–¥—ñ–ª—é–≤–∞—á" />
        </div>
        {% endif %}
        
        <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è - –ù–ê –í–°–Æ –®–ò–†–ò–ù–£ -->
        <div class="category-row">
            <div class="category-pill">{{ section }}</div>
        </div>
        
        {% for item in section_items %}
        {% set is_alt = item.is_alternative or false %}
        {% set alt_group = item.alternative_group_id or '' %}
        <div class="item-row {% if is_alt %}item-row-alternative{% endif %}">
            <div class="item-row-inner">
                <div class="item-cell name-col">
                    {% if is_alt %}
                    <span class="alternative-badge">–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê</span>
                    {% endif %}
                    {{ item.name }}
                    {% if item.can_cook_on_location %}
                    <span class="location-icon" title="–ú–æ–∂–Ω–∞ –≥–æ—Ç—É–≤–∞—Ç–∏ –Ω–∞ –ª–æ–∫–∞—Ü—ñ—ó (–±—É–¥–∏–Ω–æ–∫/–ø–∞–ª–∞—Ç–∫–∞/–≤–æ–≥–æ–Ω—å)">üè†</span>
                    {% endif %}
                    {% if is_alt and alt_group %}
                    {% set alt_items = fmt['items'] | selectattr('alternative_group_id', 'equalto', alt_group) | selectattr('name', 'ne', item.name) | list %}
                    {% if alt_items %}
                    <span class="alternative-hint">(–∞–±–æ: {{ alt_items | map(attribute='name') | join(', ') }})</span>
                    {% endif %}
                    {% endif %}
                </div>
                <div class="item-cell photo-col">
                    {% if item.photo_src %}
                    <img src="{{ item.photo_src }}" class="item-photo" alt="">
                    {% endif %}
                </div>
                <div class="item-cell value-col">{% if item.weight_raw %}{% set weight_grams = item.weight_raw * 1000 %}{{ weight_grams|format_number }}{% else %}‚Äî{% endif %}</div>
                <div class="item-cell value-col">{{ item.quantity }}</div>
                <div class="item-cell value-col">{% if item.price_raw %}{{ item.price_raw|format_number }} ‚Ç¥{% else %}‚Äî{% endif %}</div>
                <div class="item-cell value-col">{% if item.total_raw %}{{ item.total_raw|format_number }} ‚Ç¥{% else %}‚Äî{% endif %}</div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
        {% endfor %}
        
        <!-- –°—Ç—Ä–∞–≤–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
        {% set uncategorized = fmt['items'] | rejectattr('category_name') | list %}
        {% if uncategorized %}
        <div class="category-row">
            <div class="category-pill">–Ü–ù–®–Ü –°–¢–†–ê–í–ò</div>
        </div>
        {% for item in uncategorized %}
        {% set is_alt = item.is_alternative or false %}
        {% set alt_group = item.alternative_group_id or '' %}
        <div class="item-row {% if is_alt %}item-row-alternative{% endif %}">
            <div class="item-row-inner">
                <div class="item-cell name-col">
                    {% if is_alt %}
                    <span class="alternative-badge">–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê</span>
                    {% endif %}
                    {{ item.name }}
                    {% if item.can_cook_on_location %}
                    <span class="location-icon" title="–ú–æ–∂–Ω–∞ –≥–æ—Ç—É–≤–∞—Ç–∏ –Ω–∞ –ª–æ–∫–∞—Ü—ñ—ó (–±—É–¥–∏–Ω–æ–∫/–ø–∞–ª–∞—Ç–∫–∞/–≤–æ–≥–æ–Ω—å)">üè†</span>
                    {% endif %}
                    {% if is_alt and alt_group %}
                    {% set alt_items = fmt['items'] | selectattr('alternative_group_id', 'equalto', alt_group) | selectattr('name', 'ne', item.name) | list %}
                    {% if alt_items %}
                    <span class="alternative-hint">(–∞–±–æ: {{ alt_items | map(attribute='name') | join(', ') }})</span>
                    {% endif %}
                    {% endif %}
                </div>
                <div class="item-cell photo-col">
                    {% if item.photo_src %}
                    <img src="{{ item.photo_src }}" class="item-photo" alt="">
                    {% endif %}
                </div>
                <div class="item-cell value-col">{% if item.weight_raw %}{% set weight_grams = item.weight_raw * 1000 %}{{ weight_grams|format_number }}{% else %}‚Äî{% endif %}</div>
                <div class="item-cell value-col">{{ item.quantity }}</div>
                <div class="item-cell value-col">{% if item.price_raw %}{{ item.price_raw|format_number }} ‚Ç¥{% else %}‚Äî{% endif %}</div>
                <div class="item-cell value-col">{% if item.total_raw %}{{ item.total_raw|format_number }} ‚Ç¥{% else %}‚Äî{% endif %}</div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
        
        <!-- –ü—ñ–¥—Å—É–º–æ–∫ –º–µ–Ω—é -->
        <div class="summary-gray">
            <div class="summary-gray-line summary-gray-bold">–í–°–¨–û–ì–û –ó–ê –ú–ï–ù–Æ: {{ fmt.food_total_formatted }}</div>
            {% if fmt.discount_percent and fmt.discount_amount %}
            <div class="summary-gray-line">–∑–Ω–∏–∂–∫–∞ –Ω–∞ –º–µ–Ω—é {{ fmt.discount_percent }}% - {{ fmt.discount_amount_formatted }}</div>
            {% endif %}
            {% if fmt.total_after_discount %}
            <div class="summary-gray-line summary-gray-bold">–∑–∞ –º–µ–Ω—é –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–Ω–∏–∂–∫–∏: {{ fmt.total_after_discount_formatted }}</div>
            {% endif %}
        </div>
        
        {% endfor %}
        {% endif %}
        
        <!-- –û–ë–õ–ê–î–ù–ê–ù–ù–Ø -->
        {% if (not template_config or template_config.show_equipment_block) and equipment_total %}
        <div class="section-header">–û–ë–õ–ê–î–ù–ê–ù–ù–Ø</div>
        
        <div class="table-header">
            <div class="table-header-row">
                <div class="table-header-cell name-col">–ù–ê–ó–í–ê</div>
                <div class="table-header-cell value-col">—Ü—ñ–Ω–∞ –æ—Ä–µ–Ω–¥–∏, –≥—Ä–Ω/—à—Ç</div>
                <div class="table-header-cell value-col">—Ü—ñ–Ω–∞ –≤—Ç—Ä–∞—Ç–∏ –≥—Ä–Ω/—à—Ç</div>
                <div class="table-header-cell value-col">–∫-—Å—Ç—å, —à—Ç</div>
                <div class="table-header-cell value-col">—Å—É–º–∞, –≥—Ä–Ω</div>
            </div>
        </div>
        
        <!-- –†—è–¥–∫–∏ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è -->
        {% if equipment_items %}
        {% for eq_item in equipment_items %}
        <div class="item-row">
            <div class="item-row-inner">
                <div class="item-cell name-col">{{ eq_item.name }}</div>
                <div class="item-cell value-col">{{ "%.2f"|format(eq_item.rental_price) if eq_item.rental_price else '‚Äî' }} ‚Ç¥</div>
                <div class="item-cell value-col">{{ "%.2f"|format(eq_item.loss_price) if eq_item.loss_price else '‚Äî' }} ‚Ç¥</div>
                <div class="item-cell value-col">{{ eq_item.quantity }}</div>
                <div class="item-cell value-col">{% if eq_item.total %}{{ eq_item.total|format_number }} ‚Ç¥{% else %}‚Äî{% endif %}</div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
        
        <div class="summary-gray">
            <div class="summary-gray-line summary-gray-bold">–î–û –°–ü–õ–ê–¢–ò –ó–ê –û–ë–õ–ê–î–ù–ê–ù–ù–Ø: {{ equipment_total }}</div>
        </div>
        {% endif %}
        
        <!-- –°–ï–†–í–Ü–°–ù–ï –û–ë–°–õ–£–ì–û–í–£–í–ê–ù–ù–Ø -->
        {% if (not template_config or template_config.show_service_block) and service_total %}
        <div class="section-header">–°–ï–†–í–Ü–°–ù–ï –û–ë–°–õ–£–ì–û–í–£–í–ê–ù–ù–Ø</div>
        
        <div class="table-header">
            <div class="table-header-row">
                <div class="table-header-cell" style="width: 75%; text-align: left; padding-left: 3mm;">–ü–æ–∑–∏—Ü—ñ—è</div>
                <div class="table-header-cell" style="width: 25%; text-align: right;">—Å—É–º–∞</div>
            </div>
        </div>
        
        <!-- –†—è–¥–∫–∏ —Å–µ—Ä–≤—ñ—Å—É -->
        {% if service_items %}
        {% for srv_item in service_items %}
        <div class="service-row">
            <div class="service-cell name-col">{{ srv_item.name }}</div>
            <div class="service-cell value-col">{% if srv_item.total %}{{ srv_item.total|format_number }} ‚Ç¥{% else %}‚Äî{% endif %}</div>
        </div>
        {% endfor %}
        {% endif %}
        
        <div class="summary-gray">
            <div class="summary-gray-line summary-gray-bold">–î–û –°–ü–õ–ê–¢–ò –ó–ê –°–ï–†–í–Ü–°: {{ service_total }}</div>
        </div>
        {% endif %}
        
        <!-- –¢–†–ê–ù–°–ü–û–†–¢ -->
        {% if (not template_config or template_config.show_transport_block) and transport_total %}
        <div class="summary-gray" style="margin-top: 3mm;">
            <div class="summary-gray-line summary-gray-bold">–¢–†–ê–ù–°–ü–û–†–¢–ù–Ü –í–ò–¢–†–ê–¢–ò: {{ transport_total }}</div>
        </div>
        {% endif %}
        
        <!-- –î–ï–¢–ê–õ–¨–ù–ò–ô –ü–Ü–î–°–£–ú–û–ö -->
        {% if template_config and template_config.summary_lines %}
        <!-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è summary –∑ —à–∞–±–ª–æ–Ω—É -->
        <div class="summary-gray" style="margin-top: 3mm;">
            {% for line in template_config.summary_lines %}
            {% if line.show %}
            {% set field_value = None %}
            {% if line.field == "food_total" %}
                {% set field_value = items_total_formatted %}
            {% elif line.field == "total_weight" %}
                {% set field_value = total_weight %}
            {% elif line.field == "weight_per_person" %}
                {% set field_value = weight_per_person %}
            {% elif line.field == "price_per_person" %}
                {% set field_value = price_per_person_total_formatted %}
            {% elif line.field == "ml_per_person" %}
                {% set field_value = ml_per_person_formatted %}
            {% elif line.field == "total_items" %}
                {% set field_value = total_items %}
            {% elif line.field == "equipment_service_total" %}
                {% set field_value = equipment_service_total_formatted %}
            {% elif line.field == "discount" %}
                {% set field_value = total_discount_amount_formatted %}
            {% elif line.field == "grand_total" %}
                {% set field_value = grand_total_formatted %}
            {% elif line.field == "fop_extra" %}
                {% set field_value = fop_extra_formatted %}
            {% elif line.field == "grand_total_with_fop" %}
                {% set field_value = grand_total_with_fop_formatted %}
            {% endif %}
            {% if field_value %}
            <div class="summary-gray-line{% if line.bold %} summary-gray-bold{% endif %}">
                {{ line.label }}: {{ field_value }}
            </div>
            {% endif %}
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
        <!-- –î–µ—Ñ–æ–ª—Ç–Ω–∏–π summary (—è–∫—â–æ –Ω–µ–º–∞—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å) -->
        <div class="summary-gray" style="margin-top: 3mm;">
            <div class="summary-gray-line">–°—Ç—Ä–∞–≤–∏: {{ food_total }}</div>
            {% if total_weight %}
            <div class="summary-gray-line">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞–≥–∞: {{ total_weight }}</div>
            {% endif %}
            {% if weight_per_person %}
            <div class="summary-gray-line">–í–∞–≥–∞ –Ω–∞ –ª—é–¥–∏–Ω—É: {{ weight_per_person }}</div>
            {% endif %}
            {% if price_per_person_total_formatted %}
            <div class="summary-gray-line">–¶—ñ–Ω–∞ –Ω–∞ –æ—Å–æ–±—É: {{ price_per_person_total_formatted }}</div>
            {% endif %}
            {% if ml_per_person_formatted %}
            <div class="summary-gray-line">–ú–ª –Ω–∞ –æ—Å–æ–±—É: {{ ml_per_person_formatted }}</div>
            {% endif %}
            {% if total_items %}
            <div class="summary-gray-line">–í—Å—å–æ–≥–æ –ø–æ–∑–∏—Ü—ñ–π: {{ total_items }}</div>
            {% endif %}
            {% if equipment_service_total_formatted %}
            <div class="summary-gray-line">–°–µ—Ä–≤—ñ—Å/–æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è: {{ equipment_service_total_formatted }}</div>
            {% endif %}
            {% if discount_percent and total_discount_amount_formatted %}
            <div class="summary-gray-line">–ó–Ω–∏–∂–∫–∞: -{{ total_discount_amount_formatted }}</div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- –§–Ü–ù–ê–õ–¨–ù–ò–ô –ü–Ü–î–°–£–ú–û–ö -->
        <div class="final-summary">
            <div class="final-summary-main">–í–°–¨–û–ì–û –î–û –°–ü–õ–ê–¢–ò: {{ grand_total_formatted }}</div>
            {% if fop_percent and fop_extra_formatted %}
            <div class="final-summary-fop">–§–û–ü 3-—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (+{{ fop_percent|round(0)|int }}%): {{ fop_extra_formatted }}</div>
            <div class="final-summary-fop" style="font-weight: bold; margin-top: 2mm;">–†–∞–∑–æ–º –¥–æ –æ–ø–ª–∞—Ç–∏: {{ grand_total_with_fop_formatted }}</div>
            {% endif %}
        </div>
        
        <!-- –£–ú–û–í–ò –ë–†–û–ù–Æ–í–ê–ù–ù–Ø (–∑ —à–∞–±–ª–æ–Ω—É) -->
        {% if booking_terms %}
        <div class="booking-terms">
            <div class="booking-terms-title">–£–ú–û–í–ò –ë–†–û–ù–Æ–í–ê–ù–ù–Ø –ó–ê–•–û–î–£:</div>
            <div class="booking-terms-list">
                {% for line in booking_terms.split('\n') %}
                {% if line.strip() %}
                <div class="booking-terms-item">{{ line.strip() }}</div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- –ì–ê–õ–ï–†–ï–Ø –§–û–¢–û -->
        {% if gallery_photos and gallery_photos|length > 0 %}
        <div class="gallery">
            {% for row_num in range(0, (gallery_photos|length + 2) // 3) %}
            <div class="gallery-row">
                {% for col_num in range(3) %}
                    {% set photo_index = row_num * 3 + col_num %}
                    {% if photo_index < gallery_photos|length %}
                    <div class="gallery-item">
                        <img src="{{ gallery_photos[photo_index] }}" class="gallery-photo" alt="">
                    </div>
                    {% else %}
                    <div class="gallery-item"></div>
                    {% endif %}
                {% endfor %}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- –§—É—Ç–µ—Ä -->
        {% if template_config and template_config.footer_text %}
        <div class="footer">
            <p>{{ template_config.footer_text }}</p>
        </div>
        {% endif %}
        
    </div>
</body>
</html>
